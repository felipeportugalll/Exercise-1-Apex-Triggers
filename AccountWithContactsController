public with sharing class AccountWithContactsController {
    public Account account { get; private set; }
    public String contactNameFilter { get; set; }
    public List<ContactWrapper> relatedContacts { get; private set; }
    public Boolean displayConfirmationPopup { get; private set; }
    public String selectedContactId { get; set; }
    public String confirmSetAsPrimaryUrl { get; private set; }

    public AccountWithContactsController(ApexPages.StandardController stdController) {
        this.account = (Account)stdController.getRecord();
        this.relatedContacts = new List<ContactWrapper>();
        this.contactNameFilter = '';
        this.displayConfirmationPopup = false;
        this.selectedContactId = null;
        this.confirmSetAsPrimaryUrl = '';
        this.loadRelatedContacts();
    }

    public void loadRelatedContacts() {
        // Logic to query and load related contacts based on the account
        // Use contactNameFilter if provided
        // Populate relatedContacts list
    }

    public void searchContacts() {
        loadRelatedContacts();
    }

    public void setAsPrimary() {
        // Set the selected contact as primary and others as secondary
        // Update the IsPrimary field on Contact object
        // Display confirmation pop-up before updating
        displayConfirmationPopup = true;
        confirmSetAsPrimaryUrl = '/apex/AccountWithContactsPage?id=' + selectedContactId;
    }

    public class ContactWrapper {
        public Contact contact { get; set; }
        public Boolean isPrimary { get; set; }

        public ContactWrapper(Contact c) {
            this.contact = c;
            this.isPrimary = c.Is_Primary_Contact__c; // Replace with the actual API name of the Is Primary Contact field
        }
    }
}
